// https://leetcode.com/problems/find-all-people-with-secret

pub fn find_all_people(n: i32, meetings: Vec<Vec<i32>>, first_person: i32) -> Vec<i32> {
    use std::collections::{HashMap, VecDeque};
    let (n, first_person) = (n as usize, first_person as usize);

    let mut out_edges: HashMap<usize, Vec<(usize, usize)>> = HashMap::new();
    for meeting in meetings.iter() {
        let (a, b, time) = (
            meeting[0] as usize,
            meeting[1] as usize,
            meeting[2] as usize,
        );
        out_edges.entry(a).or_default().push((time, b));
        out_edges.entry(b).or_default().push((time, a));
    }

    let mut earliest = vec![usize::MAX; n];
    earliest[0] = 0;
    earliest[first_person] = 0;

    let mut queue = VecDeque::new();
    queue.push_back((0, 0));
    queue.push_back((first_person, 0usize));
    while let Some((person, time)) = queue.pop_front() {
        let entry = out_edges.entry(person).or_default();
        for &(neighbor_time, neighbor_person) in entry.iter() {
            if neighbor_time >= time && earliest[neighbor_person] > neighbor_time {
                earliest[neighbor_person] = neighbor_time;
                queue.push_back((neighbor_person, neighbor_time));
            }
        }
    }

    earliest
        .into_iter()
        .enumerate()
        .filter(|(_, time)| *time != usize::MAX)
        .map(|(index, _)| index as i32)
        .collect()
}

#[cfg(test)]
mod tests {
    use super::*;

    fn check(n: i32, meetings: Vec<Vec<i32>>, first_person: i32, mut expected: Vec<i32>) {
        let mut actual = find_all_people(n, meetings, first_person);
        actual.sort_unstable();
        expected.sort_unstable();
        assert_eq!(actual, expected);
    }

    #[test]
    fn test_1() {
        check(
            6,
            vec![vec![1, 2, 5], vec![2, 3, 8], vec![1, 5, 10]],
            1,
            vec![0, 1, 2, 3, 5],
        );
    }
    #[test]
    fn test_2() {
        check(
            4,
            vec![vec![3, 1, 3], vec![1, 2, 2], vec![0, 3, 3]],
            3,
            vec![0, 1, 3],
        );
    }
    #[test]
    fn test_3() {
        check(
            5,
            vec![vec![3, 4, 2], vec![1, 2, 1], vec![2, 3, 1]],
            1,
            vec![0, 1, 2, 3, 4],
        )
    }
    #[test]
    fn test_4() {
        check(
            12,
            vec![
                vec![10, 8, 6],
                vec![9, 5, 11],
                vec![0, 5, 18],
                vec![4, 5, 13],
                vec![11, 6, 17],
                vec![0, 11, 10],
                vec![10, 11, 7],
                vec![5, 8, 3],
                vec![7, 6, 16],
                vec![3, 6, 10],
                vec![3, 11, 1],
                vec![8, 3, 2],
                vec![5, 0, 7],
                vec![3, 8, 20],
                vec![11, 0, 20],
                vec![8, 3, 4],
                vec![1, 9, 4],
                vec![10, 7, 11],
                vec![8, 10, 18],
            ],
            9,
            vec![0, 1, 4, 5, 6, 9, 11],
        )
    }
    #[test]
    fn test_5() {
        check(
            135,
            vec![
                vec![105, 18, 475],
                vec![55, 56, 229],
                vec![93, 38, 73],
                vec![74, 6, 431],
                vec![130, 95, 79],
                vec![110, 34, 373],
                vec![50, 20, 191],
                vec![99, 70, 17],
                vec![14, 21, 371],
                vec![15, 24, 52],
                vec![126, 98, 176],
                vec![86, 102, 400],
                vec![56, 72, 77],
                vec![73, 111, 290],
                vec![56, 74, 253],
                vec![37, 55, 226],
                vec![90, 52, 474],
                vec![94, 65, 192],
                vec![83, 103, 78],
                vec![103, 86, 364],
                vec![104, 68, 73],
                vec![95, 19, 88],
                vec![105, 130, 124],
                vec![62, 122, 309],
                vec![102, 98, 397],
                vec![62, 3, 437],
                vec![65, 102, 348],
                vec![35, 81, 217],
                vec![74, 83, 299],
                vec![19, 20, 423],
                vec![98, 75, 228],
                vec![93, 9, 208],
                vec![27, 47, 45],
                vec![19, 58, 307],
                vec![51, 52, 74],
                vec![53, 107, 155],
                vec![52, 46, 133],
                vec![47, 62, 66],
                vec![133, 8, 401],
                vec![55, 107, 105],
                vec![33, 117, 252],
                vec![123, 73, 494],
                vec![123, 34, 114],
                vec![2, 130, 290],
                vec![60, 126, 467],
                vec![31, 32, 71],
                vec![17, 27, 9],
                vec![87, 61, 216],
                vec![68, 127, 327],
                vec![55, 122, 102],
                vec![50, 62, 374],
                vec![111, 27, 347],
                vec![4, 125, 449],
                vec![131, 118, 46],
                vec![53, 93, 24],
                vec![95, 6, 160],
                vec![8, 3, 438],
                vec![7, 13, 381],
                vec![70, 100, 421],
                vec![16, 46, 145],
                vec![114, 7, 454],
                vec![64, 122, 282],
                vec![112, 63, 481],
                vec![34, 90, 377],
                vec![132, 37, 371],
                vec![0, 111, 226],
                vec![13, 121, 325],
                vec![39, 26, 13],
                vec![56, 125, 75],
                vec![95, 40, 473],
                vec![51, 121, 388],
                vec![80, 116, 3],
                vec![112, 30, 188],
                vec![103, 34, 187],
                vec![87, 33, 227],
                vec![118, 6, 82],
                vec![51, 129, 89],
                vec![103, 78, 269],
                vec![28, 79, 444],
                vec![101, 106, 317],
                vec![44, 82, 333],
                vec![24, 95, 443],
                vec![27, 30, 417],
                vec![52, 99, 159],
                vec![83, 69, 44],
                vec![72, 53, 158],
                vec![131, 11, 132],
                vec![77, 14, 20],
                vec![103, 92, 356],
                vec![96, 60, 249],
                vec![108, 18, 211],
                vec![2, 119, 213],
                vec![17, 124, 32],
                vec![40, 19, 77],
                vec![125, 40, 137],
                vec![100, 60, 418],
                vec![89, 51, 63],
                vec![50, 86, 33],
                vec![90, 20, 99],
                vec![57, 49, 368],
                vec![96, 7, 233],
                vec![51, 36, 18],
                vec![13, 95, 429],
                vec![7, 33, 432],
                vec![68, 92, 219],
                vec![121, 94, 42],
                vec![26, 132, 254],
                vec![113, 102, 397],
                vec![108, 126, 243],
                vec![113, 111, 3],
                vec![21, 119, 7],
                vec![54, 128, 217],
                vec![45, 114, 278],
                vec![35, 8, 360],
                vec![4, 69, 9],
                vec![99, 40, 62],
                vec![64, 128, 387],
                vec![33, 122, 338],
                vec![61, 122, 270],
                vec![91, 68, 464],
                vec![130, 11, 83],
                vec![94, 57, 308],
                vec![105, 88, 293],
                vec![81, 76, 424],
                vec![129, 96, 38],
                vec![122, 7, 481],
                vec![80, 67, 374],
                vec![120, 86, 303],
                vec![125, 119, 180],
                vec![127, 73, 58],
                vec![23, 53, 360],
                vec![45, 123, 1],
                vec![14, 102, 37],
                vec![75, 96, 461],
                vec![81, 127, 116],
                vec![72, 101, 12],
                vec![111, 125, 322],
                vec![80, 44, 483],
                vec![66, 96, 394],
                vec![72, 123, 305],
                vec![124, 128, 422],
                vec![127, 132, 469],
                vec![105, 14, 75],
                vec![70, 27, 453],
                vec![116, 98, 235],
                vec![118, 86, 430],
                vec![45, 31, 198],
                vec![114, 1, 397],
                vec![128, 10, 355],
                vec![53, 92, 190],
                vec![89, 119, 348],
                vec![81, 48, 386],
                vec![25, 43, 27],
                vec![131, 78, 138],
                vec![116, 58, 101],
                vec![83, 2, 48],
                vec![73, 55, 432],
                vec![73, 32, 55],
                vec![12, 13, 468],
                vec![11, 86, 367],
                vec![80, 73, 460],
                vec![54, 57, 410],
                vec![17, 77, 234],
                vec![97, 61, 442],
                vec![62, 14, 465],
                vec![121, 2, 353],
                vec![84, 106, 180],
                vec![33, 126, 221],
                vec![77, 48, 392],
                vec![41, 32, 392],
                vec![122, 131, 482],
                vec![6, 31, 82],
                vec![43, 40, 172],
                vec![13, 78, 279],
                vec![57, 18, 138],
                vec![18, 79, 359],
                vec![8, 73, 252],
                vec![15, 77, 285],
                vec![64, 50, 364],
                vec![89, 54, 279],
                vec![45, 11, 10],
                vec![101, 125, 11],
                vec![111, 30, 156],
                vec![120, 9, 376],
                vec![106, 11, 25],
                vec![133, 50, 74],
                vec![108, 95, 2],
                vec![11, 133, 115],
                vec![57, 79, 284],
                vec![79, 7, 314],
                vec![20, 117, 408],
                vec![104, 82, 240],
                vec![67, 115, 265],
                vec![12, 22, 401],
                vec![6, 50, 151],
                vec![20, 44, 464],
                vec![96, 48, 215],
                vec![14, 118, 86],
                vec![81, 86, 83],
                vec![13, 53, 172],
                vec![10, 128, 422],
                vec![14, 32, 134],
                vec![134, 50, 492],
                vec![99, 128, 163],
                vec![5, 119, 344],
                vec![34, 14, 246],
                vec![25, 67, 92],
                vec![76, 6, 411],
                vec![29, 77, 415],
                vec![38, 46, 158],
                vec![133, 125, 333],
                vec![35, 36, 35],
                vec![32, 70, 67],
                vec![18, 73, 87],
                vec![55, 43, 190],
                vec![69, 119, 123],
                vec![68, 3, 362],
                vec![46, 9, 21],
                vec![45, 83, 380],
                vec![39, 112, 382],
                vec![42, 27, 444],
                vec![11, 118, 350],
                vec![31, 84, 124],
                vec![36, 133, 190],
                vec![8, 77, 243],
                vec![28, 51, 493],
                vec![99, 107, 484],
                vec![93, 81, 51],
                vec![60, 12, 407],
                vec![105, 13, 264],
                vec![113, 110, 473],
                vec![118, 14, 358],
                vec![94, 75, 447],
                vec![62, 119, 48],
                vec![67, 124, 203],
                vec![29, 127, 439],
                vec![42, 61, 292],
                vec![93, 46, 206],
                vec![84, 87, 374],
                vec![72, 87, 474],
                vec![34, 48, 400],
                vec![47, 5, 384],
                vec![75, 97, 422],
                vec![12, 56, 394],
                vec![23, 102, 143],
                vec![103, 132, 57],
                vec![46, 21, 27],
                vec![1, 51, 456],
                vec![77, 45, 290],
                vec![2, 51, 243],
                vec![14, 22, 140],
                vec![53, 121, 204],
                vec![103, 117, 7],
                vec![98, 53, 487],
                vec![12, 16, 70],
                vec![115, 111, 473],
                vec![75, 74, 96],
                vec![49, 23, 326],
                vec![34, 75, 469],
                vec![27, 3, 181],
                vec![9, 40, 55],
                vec![127, 115, 225],
                vec![62, 117, 197],
                vec![84, 40, 93],
                vec![113, 11, 142],
                vec![26, 120, 488],
                vec![13, 45, 327],
                vec![67, 73, 490],
                vec![34, 21, 222],
                vec![67, 106, 443],
                vec![17, 62, 486],
                vec![43, 65, 274],
                vec![6, 101, 6],
                vec![13, 102, 455],
                vec![111, 55, 465],
                vec![75, 112, 118],
                vec![25, 10, 17],
                vec![34, 98, 277],
                vec![117, 37, 430],
                vec![85, 106, 176],
                vec![112, 13, 58],
                vec![106, 35, 164],
                vec![43, 61, 285],
                vec![45, 22, 322],
                vec![66, 55, 334],
                vec![12, 111, 23],
                vec![1, 65, 178],
                vec![93, 8, 208],
                vec![71, 68, 282],
                vec![40, 92, 212],
                vec![107, 34, 488],
                vec![62, 2, 401],
                vec![41, 120, 268],
                vec![102, 120, 352],
                vec![37, 42, 48],
                vec![60, 107, 139],
                vec![104, 91, 376],
                vec![60, 18, 172],
                vec![61, 17, 409],
                vec![20, 67, 369],
                vec![19, 3, 447],
                vec![66, 118, 37],
                vec![115, 55, 233],
                vec![30, 105, 84],
                vec![65, 127, 321],
                vec![59, 105, 236],
                vec![60, 24, 291],
                vec![65, 50, 328],
                vec![128, 63, 200],
                vec![43, 133, 150],
                vec![104, 83, 126],
                vec![12, 36, 406],
                vec![99, 132, 343],
                vec![71, 92, 17],
                vec![66, 113, 343],
                vec![36, 127, 76],
                vec![50, 129, 349],
                vec![36, 75, 409],
                vec![127, 131, 257],
                vec![36, 23, 441],
                vec![126, 83, 439],
                vec![87, 75, 268],
                vec![65, 17, 493],
                vec![87, 116, 14],
                vec![132, 125, 330],
                vec![55, 126, 297],
                vec![132, 78, 479],
                vec![44, 128, 353],
                vec![108, 35, 1],
                vec![96, 10, 43],
                vec![118, 116, 303],
                vec![46, 82, 339],
                vec![20, 12, 252],
                vec![83, 112, 416],
                vec![33, 86, 433],
                vec![100, 79, 276],
                vec![92, 38, 380],
                vec![130, 54, 194],
                vec![12, 11, 164],
                vec![35, 79, 175],
                vec![61, 3, 134],
                vec![61, 3, 338],
                vec![53, 5, 110],
                vec![130, 79, 321],
                vec![36, 7, 346],
                vec![95, 25, 110],
                vec![14, 95, 272],
                vec![132, 83, 367],
                vec![122, 119, 236],
                vec![112, 111, 167],
                vec![114, 52, 49],
                vec![76, 115, 256],
                vec![21, 65, 492],
                vec![40, 72, 485],
                vec![29, 25, 376],
                vec![33, 77, 188],
                vec![117, 122, 72],
                vec![98, 41, 108],
                vec![26, 64, 337],
                vec![114, 11, 288],
                vec![19, 49, 21],
                vec![19, 81, 324],
                vec![101, 13, 477],
                vec![7, 115, 474],
                vec![99, 31, 244],
                vec![45, 43, 30],
                vec![62, 61, 76],
                vec![109, 91, 325],
                vec![101, 117, 182],
                vec![32, 45, 245],
                vec![73, 108, 452],
                vec![27, 36, 71],
                vec![53, 123, 225],
                vec![109, 61, 60],
                vec![120, 41, 361],
                vec![50, 13, 118],
                vec![16, 39, 139],
                vec![37, 18, 209],
                vec![44, 16, 429],
                vec![129, 77, 168],
                vec![47, 21, 436],
                vec![49, 108, 379],
                vec![50, 84, 332],
                vec![114, 12, 123],
                vec![18, 63, 297],
                vec![71, 117, 39],
                vec![17, 106, 328],
                vec![134, 75, 185],
                vec![26, 123, 200],
                vec![68, 91, 411],
                vec![130, 12, 498],
                vec![41, 53, 199],
                vec![85, 13, 486],
                vec![70, 16, 71],
                vec![126, 94, 56],
                vec![3, 57, 465],
                vec![19, 30, 425],
                vec![62, 79, 222],
                vec![58, 33, 85],
                vec![56, 9, 72],
                vec![95, 30, 310],
                vec![13, 95, 495],
                vec![82, 53, 459],
                vec![23, 77, 381],
                vec![35, 95, 100],
                vec![97, 61, 423],
                vec![17, 22, 69],
                vec![46, 59, 197],
                vec![64, 108, 240],
                vec![129, 0, 437],
                vec![9, 47, 356],
                vec![53, 46, 494],
                vec![88, 53, 157],
                vec![59, 21, 63],
                vec![16, 86, 312],
                vec![132, 19, 314],
                vec![16, 45, 425],
                vec![66, 108, 193],
                vec![41, 61, 494],
                vec![4, 7, 216],
                vec![132, 82, 311],
                vec![66, 42, 162],
                vec![110, 27, 29],
                vec![131, 80, 172],
                vec![118, 13, 14],
                vec![23, 118, 434],
                vec![102, 79, 198],
                vec![15, 1, 281],
                vec![92, 110, 220],
                vec![111, 120, 133],
                vec![52, 50, 218],
                vec![34, 2, 332],
                vec![77, 39, 124],
                vec![41, 98, 227],
                vec![105, 6, 482],
                vec![66, 10, 432],
                vec![60, 113, 472],
                vec![7, 55, 25],
                vec![52, 47, 158],
                vec![79, 64, 91],
                vec![133, 75, 43],
                vec![56, 98, 222],
                vec![62, 35, 214],
                vec![31, 9, 322],
                vec![20, 105, 333],
                vec![71, 129, 21],
                vec![63, 51, 45],
                vec![90, 121, 309],
                vec![132, 117, 4],
                vec![44, 1, 470],
                vec![47, 70, 462],
                vec![11, 130, 473],
                vec![47, 19, 464],
                vec![58, 129, 374],
                vec![38, 123, 487],
                vec![97, 75, 309],
                vec![110, 98, 436],
                vec![92, 23, 24],
                vec![85, 91, 306],
                vec![8, 85, 398],
                vec![25, 130, 92],
                vec![5, 13, 2],
                vec![68, 122, 333],
                vec![116, 125, 37],
                vec![105, 78, 271],
                vec![42, 36, 349],
                vec![19, 58, 75],
                vec![103, 83, 421],
                vec![102, 27, 237],
                vec![41, 130, 307],
                vec![39, 0, 365],
                vec![86, 39, 155],
                vec![84, 8, 108],
                vec![19, 32, 188],
                vec![121, 42, 215],
                vec![110, 84, 106],
                vec![83, 119, 394],
                vec![11, 21, 499],
                vec![24, 35, 305],
                vec![7, 11, 223],
                vec![132, 37, 104],
                vec![12, 16, 403],
                vec![92, 57, 407],
                vec![19, 58, 457],
                vec![103, 86, 431],
                vec![127, 67, 45],
                vec![7, 28, 439],
                vec![133, 87, 66],
                vec![22, 99, 214],
                vec![113, 70, 243],
                vec![132, 69, 114],
                vec![91, 61, 496],
                vec![108, 73, 465],
                vec![81, 77, 292],
                vec![45, 96, 321],
                vec![77, 72, 376],
                vec![31, 57, 490],
                vec![7, 85, 61],
                vec![82, 32, 108],
                vec![69, 16, 248],
                vec![14, 70, 69],
                vec![38, 122, 370],
                vec![49, 86, 446],
                vec![33, 46, 283],
                vec![32, 15, 356],
                vec![37, 85, 121],
                vec![14, 39, 133],
                vec![98, 36, 416],
                vec![114, 22, 31],
                vec![1, 67, 360],
                vec![16, 113, 150],
                vec![13, 23, 138],
                vec![59, 105, 78],
                vec![127, 123, 26],
                vec![42, 107, 46],
                vec![86, 84, 303],
                vec![6, 9, 108],
                vec![37, 72, 206],
                vec![126, 18, 84],
                vec![75, 64, 353],
                vec![105, 4, 139],
                vec![40, 86, 135],
                vec![93, 63, 214],
                vec![42, 15, 378],
                vec![13, 89, 263],
                vec![6, 23, 134],
                vec![11, 83, 13],
                vec![18, 49, 177],
                vec![128, 133, 186],
                vec![125, 111, 253],
                vec![35, 93, 400],
                vec![53, 114, 260],
                vec![107, 66, 172],
                vec![104, 38, 57],
                vec![64, 65, 490],
                vec![4, 77, 416],
                vec![50, 122, 1],
                vec![4, 64, 275],
                vec![52, 84, 184],
                vec![12, 63, 452],
                vec![71, 126, 459],
                vec![49, 108, 432],
                vec![55, 117, 364],
                vec![62, 39, 68],
                vec![8, 39, 192],
                vec![9, 107, 89],
                vec![30, 25, 36],
                vec![107, 35, 381],
                vec![31, 55, 284],
                vec![114, 101, 55],
                vec![39, 45, 135],
            ],
            12,
            vec![
                0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22,
                23, 24, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45,
                46, 47, 48, 49, 50, 51, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
                69, 70, 71, 72, 73, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 91, 92,
                93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 105, 106, 107, 108, 110, 111, 112,
                113, 114, 115, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129,
                130, 131, 132, 133, 134,
            ],
        )
    }
}
